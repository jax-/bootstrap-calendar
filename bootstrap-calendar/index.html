<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Calendar test</title>
    <link rel="stylesheet" href="css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bs-calendar.css" />
</head>
<body>
    <div class="text-center">
        <button class="btn btn-primary" id="prev-year">Previous year</button>
        <button class="btn btn-primary" id="prev-month">Previous month</button>
        <button class="btn btn-primary" id="next-month">Next month</button>
        <button class="btn btn-primary" id="next-year">Next year</button>

        <button class="btn btn-default" id="save-events">Save events</button>
        <button class="btn btn-default" id="clear-events">Clear events</button>
    </div>
    <div id="calendar">

    </div>
    <script id="calendar-block" type="text/x-handlebars-template">
        <label class="label label-primary">{{current_year_month}}</label>
        <table class="table calendar">
            <thead>
                <tr>
                    {{#each weekdays}}
                    <th>
                        {{this}}
                    </th>
                    {{/each}}
                  </tr>
            </thead>
            {{#each weeks}}
            <tr class="week">
                {{#each this.days}}
                <td class="{{#if date_string}} week-day {{/if}}" data-day="{{dayValue}}">
                    <div class="week-day-div">
                        <ul style="list-style:none;">
                            <li><span class="date">{{date_string}}</span></li>
                            {{#each this.events}}
                            <li>
                                <span class="event" data-day="{{../dayValue}}" data-eventId="{{eventId}}" style="background-color:{{this.color}}">
                                    <b>{{this.person}} - {{this.eventName}}</b>
                                </span>
                            </li>
                            {{/each}}
                        </ul>
                    </div>
                </td>
                {{/each}}
            </tr>
            {{/each}}

        </table>
    </script>

    <div id="myModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Add new event for date <span id="modal-title-date"></span></h4>
                </div>
                <div class="modal-body">
                    <p>Please insert person name and event</p>

                    <input type="hidden" id="hidden-event-day" />
                    
                    <span>Person name:</span>
                    <input id="person" />

                    <span>Event name:</span>
                    <input id="eventName" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="add-event">Add</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</body>

</html>
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/handlebars-v1.3.0.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bs-calendar.js"></script>

<script>
    var currentDate = new Date();
    var year = currentDate.getFullYear();
    var month = currentDate.getMonth();

    var calendar = new Calendar({
        selector: '#calendar',
        debug: false,
        persist: 'localStorage',
        render: true,
        year: year,
        month: month,
    });


    $('#prev-month').click(function () {
        month--;
        if (month < 0) {
            month = 11;
            year--;
        }

        calendar.render(year, month);
    });

    $('#next-month').click(function () {
        month++;
        if (month > 11) {
            month = 0;
            year++;
        }
        
        calendar.render(year, month);
    });

    var changeYear = function(value) {
        year += value;
        calendar.render(year, month);
    };

    $('#prev-year').click(function () {
        changeYear(-1);
    });
    $('#next-year').click(function () {
        changeYear(1);
    });

    var addNewEvent = function (day) {
        var person = $('#person').val();
        var event = $('#eventName').val();

        calendar.addEvent(year, month, day, person, event);
        calendar.render(year, month);

        $('#person').val('');
        $('#eventName').val('');
    };

    $('#calendar').on('dblclick', '.week-day', function () {
        var day = $(this).data('day');

        var dateStr = year + '-' + month + '-' + day;
        $('#modal-title-date').html(dateStr);
        $('#hidden-event-day').val(day);
        var modal = $('#myModal').modal('show');
    });
    $('#calendar').on('click', '.event', function (e) {
        var day = $(this).data('day');
        var eventId = $(this).data('eventid');
        calendar.removeEvent(year, month, day, eventId);
        calendar.render(year, month);
    });

    $('#add-event').click(function () {
        var day = $('#hidden-event-day').val();
        addNewEvent(day);

        var modal = $('#myModal').modal('hide');
    });

    $('#save-events').click(function () {
        calendar.saveEvents();
        alert('events saved');
    });

    $('#clear-events').click(function () {
        calendar.clearEvents(); 
        calendar.render();
    });

    var events = calendar.getEvents();
</script>